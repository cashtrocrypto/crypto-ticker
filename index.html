<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=1920, initial-scale=1.0" />
<title>Crypto Ticker</title>
<style>
  /* Fonts: place silka-regular.woff and silka-medium.woff next to this HTML file */
  @font-face {
    font-family: 'Silka';
    src: url('./silka-regular.woff') format('woff');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }
  @font-face {
    font-family: 'Silka';
    src: url('./silka-medium.woff') format('woff');
    font-weight: 500;
    font-style: normal;
    font-display: swap;
  }

  /* Canvas 1920x1080 */
  html, body {
    margin: 0;
    padding: 0;
    background: transparent;
  }
  .canvas {
    width: 1920px;
    height: 1080px;
    position: relative;
    overflow: hidden;
    background: transparent;
  }

  /* Ticker container exact size and right alignment */
  .ticker-container {
    position: absolute;
    top: 0;
    right: 0;
    width: 1285px;
    height: 64px;
    background: #152B2B; /* green banner background */
    box-sizing: border-box;
    overflow: hidden;
  }

  /* Scroller area */
  .ticker-scroller {
    position: absolute;
    top: 0;
    left: 0;
    height: 64px;
    display: flex;
    will-change: transform;
    backface-visibility: hidden;
    transform: translate3d(0, 0, 0);
    animation: scroll-x 75s linear infinite;
  }

  /* Duplicate tracks for seamless loop */
  .ticker-track {
    display: flex;
    align-items: center;
    height: 64px;
    flex-shrink: 0;
    white-space: nowrap;
    min-width: fit-content;
  }

  /* Animation: translateX from 0% to -50% for seamless infinite loop */
  /* When trackA is fully off-screen to the left, trackB is fully visible */
  @keyframes scroll-x {
    from { 
      transform: translate3d(0, 0, 0);
    }
    to { 
      transform: translate3d(-50%, 0, 0);
    }
  }

  /* Typography */
  .ticker-item {
    display: inline-flex;
    align-items: center;
    margin-right: 40px; /* spacing between ticker items */
    white-space: nowrap;
    height: 64px;
    flex-shrink: 0;
  }

  .logo {
    width: 24px;
    height: 24px;
    min-width: 24px;
    border-radius: 50%;
    object-fit: cover;
    display: block;
  }

  .symbol {
    margin-left: 12px; /* gap between elements */
    font-family: 'Silka', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    font-weight: 500; /* Silka Medium */
    font-size: 16px;
    line-height: 1; /* 100% */
    letter-spacing: 0.05em; /* 5% of font size */
    color: #ffffff;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .price {
    margin-left: 12px;
    font-family: 'Silka', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    font-weight: 400; /* Silka Regular */
    font-size: 16px;
    line-height: 1;
    letter-spacing: 0.05em; /* 5% of font size */
    color: #ffffff;
    background: #1F3D3D;
    border-radius: 10px;
    padding: 6px 8px; /* 6px top/bottom, 8px left/right */
    white-space: nowrap;
  }

  .percent {
    margin-left: 12px;
    font-family: 'Silka', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    font-weight: 400; /* Silka Regular */
    font-size: 16px;
    line-height: 1;
    letter-spacing: 0.05em; /* 5% of font size */
    border-radius: 10px;
    padding: 6px 8px;
    white-space: nowrap;
  }

  .percent.positive {
    background: #20513C;
    color: #3EDF84;
  }

  .percent.negative {
    background: rgba(230, 100, 36, 0.29); /* #E66424 with 4A (74/255 â‰ˆ 0.29) alpha */
    color: #DD7900;
  }

  /* Ensure no accidental extra spacing inflates dimensions */
  * { box-sizing: border-box; }
</style>
</head>
<body>
  <div class="canvas">
    <div class="ticker-container" id="ticker">
      <div class="ticker-scroller" id="scroller">
        <div class="ticker-track" id="trackA"></div>
        <div class="ticker-track" id="trackB"></div>
      </div>
    </div>
  </div>

<script>
(function() {
  // Top 20 cryptocurrencies by market cap (from CoinGecko)
  const TICKER_IDS = [
    'bitcoin',           // 1. Bitcoin (BTC)
    'ethereum',          // 2. Ethereum (ETH)
    'ripple',            // 3. XRP (XRP)
    'binancecoin',       // 4. BNB (BNB)
    'solana',            // 5. Solana (SOL)
    'tron',              // 6. TRON (TRX)
    'dogecoin',          // 7. Dogecoin (DOGE)
    'cardano',           // 8. Cardano (ADA)
    'wrapped-bitcoin',   // 9. Wrapped Bitcoin (WBIT)
    'hyperliquid',       // 10. Hyperliquid (HYPE)
    'chainlink',         // 11. Chainlink (LINK)
    'bitcoin-cash',      // 12. Bitcoin Cash (BCH)
    'stellar',           // 13. Stellar (XLM)
    'unus-sed-leo',      // 14. LEO Token (LEO)
    'zcash',             // 15. Zcash (ZEC)
    'sui',               // 16. Sui (SUI)
    'hedera-hashgraph',  // 17. Hedera (HBAR)
    'avalanche-2',       // 18. Avalanche (AVAX)
    'litecoin',          // 19. Litecoin (LTC)
    'monero'             // 20. Monero (XMR)
  ];

  const LOGO_URL = {
    bitcoin: 'https://assets.coingecko.com/coins/images/1/small/bitcoin.png',
    ethereum: 'https://assets.coingecko.com/coins/images/279/small/ethereum.png',
    ripple: 'https://assets.coingecko.com/coins/images/44/small/xrp-symbol-white-128.png',
    binancecoin: 'https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png',
    solana: 'https://assets.coingecko.com/coins/images/4128/small/solana.png',
    tron: 'https://assets.coingecko.com/coins/images/1094/small/tron-logo.png',
    dogecoin: 'https://assets.coingecko.com/coins/images/5/small/dogecoin.png',
    cardano: 'https://assets.coingecko.com/coins/images/975/small/cardano.png',
    'wrapped-bitcoin': 'https://assets.coingecko.com/coins/images/7598/small/wrapped_bitcoin_wbtc.png',
    hyperliquid: 'https://assets.coingecko.com/coins/images/34130/small/hyperliquid.png',
    chainlink: 'https://assets.coingecko.com/coins/images/877/small/chainlink-new-logo.png',
    'bitcoin-cash': 'https://assets.coingecko.com/coins/images/780/small/bitcoin-cash-circle.png',
    stellar: 'https://assets.coingecko.com/coins/images/100/small/stellar.png',
    'unus-sed-leo': 'https://assets.coingecko.com/coins/images/8418/small/leo-token.png',
    zcash: 'https://assets.coingecko.com/coins/images/486/small/zcash.png',
    sui: 'https://assets.coingecko.com/coins/images/26375/small/sui.png',
    'hedera-hashgraph': 'https://assets.coingecko.com/coins/images/3688/small/hbar.png',
    'avalanche-2': 'https://assets.coingecko.com/coins/images/12559/small/coin-round-red.png',
    litecoin: 'https://assets.coingecko.com/coins/images/2/small/litecoin.png',
    monero: 'https://assets.coingecko.com/coins/images/69/small/monero.png'
  };

  const SYMBOL = {
    bitcoin: 'BTC',
    ethereum: 'ETH',
    ripple: 'XRP',
    binancecoin: 'BNB',
    solana: 'SOL',
    tron: 'TRX',
    dogecoin: 'DOGE',
    cardano: 'ADA',
    'wrapped-bitcoin': 'WBIT',
    hyperliquid: 'HYPE',
    chainlink: 'LINK',
    'bitcoin-cash': 'BCH',
    stellar: 'XLM',
    'unus-sed-leo': 'LEO',
    zcash: 'ZEC',
    sui: 'SUI',
    'hedera-hashgraph': 'HBAR',
    'avalanche-2': 'AVAX',
    litecoin: 'LTC',
    monero: 'XMR'
  };

  // Demo data with realistic prices (shown immediately; updated after fetch)
  const DEMO_PRICES = {
    bitcoin: 43250.50,
    ethereum: 2650.75,
    ripple: 0.62,
    binancecoin: 315.20,
    solana: 98.45,
    tron: 0.12,
    dogecoin: 0.092,
    cardano: 0.48,
    'wrapped-bitcoin': 43200.00,
    hyperliquid: 0.85,
    chainlink: 14.85,
    'bitcoin-cash': 245.60,
    stellar: 0.11,
    'unus-sed-leo': 5.20,
    zcash: 25.50,
    sui: 2.04,
    'hedera-hashgraph': 0.078,
    'avalanche-2': 36.80,
    litecoin: 72.40,
    monero: 150.00
  };

  const demoData = TICKER_IDS.map((id) => ({
    id,
    symbol: SYMBOL[id] || id.toUpperCase(),
    price: DEMO_PRICES[id] || 0.01,
    change24h: (Math.random() * 10 - 5).toFixed(2), // -5% to +5%
    logo: LOGO_URL[id]
  }));

  const trackA = document.getElementById('trackA');
  const trackB = document.getElementById('trackB');

  function formatPrice(v) {
    const n = Number(v);
    if (n >= 1000) return n.toLocaleString(undefined, { maximumFractionDigits: 2, minimumFractionDigits: 2 });
    if (n >= 1) return n.toLocaleString(undefined, { maximumFractionDigits: 2, minimumFractionDigits: 2 });
    return n.toLocaleString(undefined, { maximumFractionDigits: 6, minimumFractionDigits: 2 });
  }

  function renderItems(data) {
    const makeItem = (item) => {
      const container = document.createElement('div');
      container.className = 'ticker-item';

      const img = document.createElement('img');
      img.className = 'logo';
      img.alt = item.symbol;
      img.width = 24;
      img.height = 24;
      img.loading = 'eager';
      img.src = item.logo || '';
      img.onerror = function() {
        // Hide broken images gracefully
        this.style.display = 'none';
      };

      const sym = document.createElement('div');
      sym.className = 'symbol';
      sym.textContent = item.symbol || item.id.toUpperCase();

      const price = document.createElement('div');
      price.className = 'price';
      price.textContent = `$${formatPrice(item.price)}`;

      const percent = document.createElement('div');
      const isPos = Number(item.change24h) >= 0;
      percent.className = 'percent ' + (isPos ? 'positive' : 'negative');
      const sign = isPos ? '+' : '';
      percent.textContent = `${sign}${Number(item.change24h).toFixed(2)}%`;

      container.appendChild(img);
      container.appendChild(sym);
      container.appendChild(price);
      container.appendChild(percent);
      return container;
    };

    // Clear and rebuild tracks
    trackA.innerHTML = '';
    trackB.innerHTML = '';

    // Create items once
    const items = data.map(d => makeItem(d));
    
    // Each track gets identical content - this ensures seamless infinite loop
    // When trackA scrolls off to the left, trackB (identical content) appears from the right
    items.forEach(item => trackA.appendChild(item));
    items.forEach(item => trackB.appendChild(item.cloneNode(true)));
  }


  async function fetchWithFallbacks() {
    const base = 'https://api.coingecko.com/api/v3/simple/price';
    const params = new URLSearchParams({
      ids: TICKER_IDS.join(','),
      vs_currencies: 'usd',
      include_24hr_change: 'true'
    });

    const endpoints = [
      `${base}?${params.toString()}`,
      `https://api.allorigins.win/raw?url=${encodeURIComponent(`${base}?${params.toString()}`)}`
    ];

    for (const url of endpoints) {
      try {
        const res = await fetch(url, { cache: 'no-store', mode: 'cors' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const json = await res.json();
        return json;
      } catch (e) {
        // try next
      }
    }
    return null;
  }

  function mergeLiveData(json) {
    if (!json) return null;
    try {
      const out = TICKER_IDS.map((id, index) => {
        const entry = json[id];
        const price = entry && (entry.usd ?? entry.USD);
        const change = entry && (entry.usd_24h_change ?? entry.usd24hchange ?? entry.usd_change_24h);
        
        // If price is missing or invalid, use demo data price
        const finalPrice = (typeof price === 'number' && price > 0) 
          ? price 
          : Number(demoData[index].price);
        
        const finalChange = (typeof change === 'number') 
          ? change 
          : Number(demoData[index].change24h);
        
        return {
          id,
          symbol: SYMBOL[id] || id.toUpperCase(),
          price: finalPrice,
          change24h: finalChange,
          logo: LOGO_URL[id]
        };
      });
      return out;
    } catch (error) {
      console.error('Error merging live data:', error);
      return null;
    }
  }

  let isRefreshing = false;
  
  async function refresh() {
    // Prevent concurrent refreshes
    if (isRefreshing) return;
    isRefreshing = true;
    
    try {
      const raw = await fetchWithFallbacks();
      const merged = mergeLiveData(raw);
      if (merged) {
        renderItems(merged);
      }
    } catch (error) {
      console.error('Refresh error:', error);
    } finally {
      isRefreshing = false;
    }
  }

  // Initialize: Show demo immediately (no loading screen)
  renderItems(demoData);
  
  // Animation starts immediately via CSS, no delay needed

  // First refresh shortly after load to avoid jank
  setTimeout(refresh, 500);
  // Update every 60 seconds
  setInterval(refresh, 60000);
})();
</script>
</body>
</html> 
